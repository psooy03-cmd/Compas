<!DOCTYPE html>
<html lang="ko" dir="ltr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="color-scheme" content="light" />
<title>ì‚¬ë‚´ í¬í„¸ â€“ iOS í´ë” ìŠ¤íƒ€ì¼ + ì „ì‚¬ì¼ì •&í–‰ì‚¬ (í•„í„°/ì…ë ¥ ê¸°ëŠ¥ í¬í•¨)</title>
<style>
  :root{
    --bg:#f6f7f9; --folder:#ffffff; --line:rgba(0,0,0,.06); --card:#fff; --grid:#e5e7eb; --text:#0f172a;
    --focus:#2563eb; --muted:#64748b; --shadow:0 12px 24px rgba(0,0,0,.06);
    --lane-h:64px; --lane-gap:1px; --left-col:160px; --header-h:34px; --cell-pad:8px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:24px; font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,sans-serif; background:var(--bg); color:var(--text)}
  img{max-width:100%; display:block}
  a{color:inherit}
  a:focus-visible,button:focus-visible{outline:3px solid var(--focus); outline-offset:3px; border-radius:8px}
  .visually-hidden{position:absolute!important;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0 0 0 0);white-space:nowrap;border:0}

  h1{margin:0 0 20px; font-size:18px}
  h2{margin:28px 0 12px; font-size:16px}
  .container{max-width:1200px; margin:0 auto}
  .grid{display:grid; grid-template-columns:repeat(auto-fit,minmax(240px,1fr)); gap:24px}

  /* í´ë” ì¹´ë“œ */
  .folder{background:var(--folder);
border-radius:28px;
padding:18px 16px;
border:1px solid var(--line);
box-shadow:var(--shadow), inset 0 1px 0 rgba(255,255,255,.7);
transition:transform .15s, box-shadow .15s, background-color .15s, color .15s;}

  .folder:hover{ transform:translateY(-2px); 
box-shadow:0 16px 30px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.7);
background: #e5e7eb;  /* hover ì‹œ ë°°ê²½ìƒ‰ ì‚´ì§ ì§„í•˜ê²Œ */ }

.folder:hover .label {
  color: #1e293b;  /* ê¸°ë³¸ë³´ë‹¤ ì¡°ê¸ˆ ë” ì§„í•œ ë‚¨ìƒ‰í†¤ */
}

  .apps{display:grid; grid-template-columns:repeat(3,1fr); gap:10px}
  .app{display:flex; align-items:center; justify-content:center; flex-direction:column; text-decoration:none; color:var(--text); gap:6px}
  .badge{width:58px;height:58px;border-radius:16px;display:flex;align-items:center;justify-content:center;box-shadow:inset 0 1px 0 rgba(255,255,255,.25), 0 6px 14px rgba(0,0,0,.08);transition:transform .12s, box-shadow .12s; font-weight:700; font-size:12px; color:#fff}
  .app:hover .badge{ transform:translateY(-1px); box-shadow:inset 0 1px 0 rgba(255,255,255,.25), 0 10px 18px rgba(0,0,0,.12) }
  .label{font-size:10px;color:#334155;text-align:center;max-width:64px;line-height:1.2}
  .c-red{background:linear-gradient(135deg,#ff6a7a,#ff3d3d)}
  .c-purple{background:linear-gradient(135deg,#a77bff,#7a4cff)}
  .c-sky{background:linear-gradient(135deg,#79b6ff,#4a8dfff)}
  .c-orange{background:linear-gradient(135deg,#ffa552,#ff7a1a)}
  .c-green{background:linear-gradient(135deg,#55d6a9,#26b87a)}
  .c-blue{background:linear-gradient(135deg,#6e8cff,#3b5bff)}
  .c-teal{background:linear-gradient(135deg,#64e0e3,#28c3d6)}
  .c-gray{background:linear-gradient(135deg,#c9ced6,#9aa3ad)}

  .folder-label{display:flex;align-items:center;justify-content:center;gap:6px;margin-top:8px;font-size:14px}
  .folder-label .emoji{font-size:18px}

  /* ì¹´ë“œ */
  .card{background:var(--card);border:1px solid var(--grid);border-radius:14px;box-shadow:0 2px 6px rgba(0,0,0,.04)}

  /* ì»¨íŠ¸ë¡¤ */
  .controls{display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin:10px 0 6px}
  .seg{display:inline-flex;border:1px solid var(--grid);border-radius:10px;overflow:hidden}
  .seg button{padding:6px 10px;border:0;background:#fff;font-size:12px;cursor:pointer}
  .seg button[aria-pressed="true"]{background:#eef2ff}
  .pill{display:inline-flex;align-items:center;gap:6px;border:1px solid(var(--grid));border:1px solid var(--grid);border-radius:999px;padding:6px 10px;background:#fff;font-size:12px;cursor:pointer}
  .pill[aria-pressed="true"]{background:#dcfce7}
  .scroll-x{display:flex;gap:8px;overflow:auto;padding-bottom:2px}

  /* ===== SP Modern header / toolbar (ì¶”ê°€) ===== */
  .sp-hero{margin:12px 0 8px}
  .sp-breadcrumb{font-size:12px;color:#6b7280;display:flex;gap:8px;align-items:center}
  .sp-breadcrumb .sep{opacity:.5}
  .sp-titlebar{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-top:6px}
  .sp-titlebar h2{margin:0;font-size:22px}
  .sp-sub{margin:6px 0 0;color:#64748b;font-size:13px}
  .btn{border:1px solid var(--grid);background:#fff;border-radius:10px;padding:8px 12px;font-size:13px;cursor:pointer}
  .btn.ghost{background:#fafafa}
  .btn.primary{background:#2563eb;color:#fff;border-color:#2563eb}
  .btn:focus-visible{outline:3px solid var(--focus);outline-offset:2px}
  .btn[aria-pressed="true"]{box-shadow:inset 0 0 0 2px #2563eb33}

  /* ì—°ê°„ ë§¤íŠ¸ë¦­ìŠ¤ */
  .year-grid{position:relative;overflow:hidden}
  .header,.row{display:grid;grid-template-columns:var(--left-col) repeat(12,1fr)}
  .header div,.row div{padding:var(--cell-pad);border-bottom:1px solid var(--grid)}
  .header{background:#f7f8fa;font-size:12px;font-weight:600;position:sticky;top:0;z-index:2} /* í†¤ ì¡°ì • */
  .lane-name{padding:10px 12px;border-right:1px solid var(--grid);display:flex;align-items:center;font-size:12px;font-weight:600;background:#f9fafb;color:#111827}
  .cell{height:var(--lane-h);border-left:1px solid var(--grid)}
  .row .cell:first-child{border-left:none}
  .grid-lines{position:absolute;inset:var(--header-h) 0 0 var(--left-col);display:grid;grid-template-columns:repeat(12,1fr);pointer-events:none}
  .grid-lines div{border-left:1px dashed #e6e6e6}
  .bar-layer{position:absolute;inset:var(--header-h) 0 0 var(--left-col)}
  .event{position:absolute;height:26px;border-radius:8px;padding:4px 8px;font-size:12px;line-height:18px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;cursor:pointer;box-shadow:0 1px 3px rgba(0,0,0,.08);border:1px solid rgba(0,0,0,.05);font-weight:600}
  .t-ì „ëµ{background:#e0f2fe}
  .t-ì¬ê²½{background:#d1fae5}
  .t-ì¸ì‚¬{background:#fef9c3}
  .t-ì»´í”Œë¼ì´ì–¸ìŠ¤{background:#fee2e2}
  .t-IT{background:#e5e7eb}
  .t-ìš´ì˜{background:#f5e8ff}
  .t-ë§ˆì¼€íŒ…{background:#e7fff2}
  .t-ì˜ì—…{background:#fff0e5}
  .t-êµìœ¡{background:#ffe7fb}
  .t-í–‰ì‚¬{background:#e0e7ff}
  .today-line{position:absolute;top:var(--header-h);bottom:0;width:2px;background:#2563eb33;pointer-events:none}

  /* Compact density (ì¶”ê°€) */
  body.compact :root{ --lane-h:40px; }
  body.compact .event{height:20px;padding:2px 8px;font-size:11px;line-height:16px;border-radius:6px}

  /* ëª¨ë‹¬ */
  #modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:20px}
  #modal[aria-hidden="false"]{display:flex}
  #modal .box{background:#fff;border-radius:14px;padding:18px;max-width:560px;width:100%;border:1px solid var(--grid);box-shadow:0 10px 30px rgba(0,0,0,.15)}
  #modal h3{margin:0 0 8px;font-size:16px}
  #modal p{margin:6px 0 0;font-size:13px;color:#334155;white-space:pre-line}
  .modal-actions{display:flex;justify-content:flex-end;gap:8px;margin-top:16px}
  button{border:1px solid var(--grid);border-radius:10px;background:#fff;padding:8px 10px;cursor:pointer}
  .hint{font-size:12px;color:var(--muted);margin-top:8px}

  /* ì ‘ê·¼ì„±: ê°ì† ì„ í˜¸ */
  @media (prefers-reduced-motion: reduce){
    .folder,.badge{transition:none}
  }

  /* í”„ë¦°íŠ¸: ì—°ê°„í‘œë§Œ */
  @media print{
    body{margin:0}
    .grid,.imgbox,.hint,h1,.controls,#event-form,.sp-hero{display:none}
    .year-grid{border:0}
  }
/* ===== Tooltip (apps ê³µí†µ) ===== */
.tooltip {
  position: fixed;
  z-index: 9999;
  max-width: 260px;
  font-size: 12px;
  line-height: 1.4;
  padding: 8px 10px;
  border-radius: 10px;
  background: #fff;
  color: #111827;
  border: 1px solid #e5e7eb;
  box-shadow: 0 8px 24px rgba(0,0,0,.18);
  pointer-events: none;
  transform: translate(-50%, -8px);
  opacity: 0;
  transition: opacity .12s ease, transform .12s ease;
}
.tooltip[data-show="true"] {
  opacity: 1;
  transform: translate(-50%, -12px);
}
/* ê³ ëŒ€ë¹„ ëª¨ë“œ ëŒ€ë¹„ */
@media (prefers-contrast: more) {
  .tooltip { outline: 2px solid #fff; }
}

</style>
</head>
<body>
<div class="container" role="main">
  <h1>ğŸ“ ì¹´í…Œê³ ë¦¬ (iOS í´ë” ìŠ¤íƒ€ì¼)</h1>

  <div class="grid">
    <!-- â¤ï¸ P&C -->
    <section aria-labelledby="sec-pc">
      <div class="folder" role="group" aria-labelledby="sec-pc">
        <div class="apps">
  <!-- ì¸ì‚¬ê·¼íƒœ -->
  <a class="app"
   href="#"
   target="_blank"
   rel="noopener noreferrer"
   data-tooltip="ì»´íŒ¨ì…”ë„ˆì˜ ì¶œê·¼,í‡´ê·¼,ì—°ì°¨ ë“± í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤">
  <div class="badge c-red" aria-hidden="true"><span aria-hidden="true">ê·¼íƒœ</span></div>
  <div class="label">ì¸ì‚¬ê·¼íƒœ</div>
</a>
         <!-- ì¡°ì§ë„ -->
      <a class="app"
         href="#"
         target="_blank"
         rel="noopener noreferrer"
         data-tooltip="íšŒì‚¬ ì „ì²´ ì¡°ì§ë„ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤">
        <div class="badge c-purple"><span aria-hidden="true">ì¡°ì§</span></div>
        <div class="label">ì¡°ì§ë„</div>
      </a>
          <!-- ì—°ë½ì²˜ -->
      <a class="app"
         href="#"
         target="_blank"
         rel="noopener noreferrer"
         data-tooltip="ì‚¬ë‚´ ì£¼ìš” ì—°ë½ì²˜ë¥¼ ê²€ìƒ‰í•˜ê³  í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤">
        <div class="badge c-sky">ì—°ë½</div>
        <div class="label">ì—°ë½ì²˜</div>
      </a>
          <!-- ì‚¬ë²ˆ ì¡°íšŒ -->
      <a class="app"
         href="#"
         target="_blank"
         rel="noopener noreferrer"
         data-tooltip="ì‚¬ë²ˆ ì •ë³´ë¥¼ í™•ì¸í•˜ê³  ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤">
        <div class="badge c-orange">ID</div>
        <div class="label">ì‚¬ë²ˆ</div>
      </a>
          <!-- Blue line -->
      <a class="app"
         href="#"
         target="_blank"
         rel="noopener noreferrer"
         data-tooltip="ì‚¬ë‚´ ì†Œí†µ í”Œë«í¼ Blue lineì— ì ‘ì†í•©ë‹ˆë‹¤">
        <div class="badge c-blue">BL</div>
        <div class="label">Blue line</div>
      </a>

 <!-- Blue line -->
      <a class="app"
         href="#"
         target="_blank"
         rel="noopener noreferrer"
         data-tooltip="ì‚¬ë‚´ ì†Œí†µ í”Œë«í¼ Blue lineì— ì ‘ì†í•©ë‹ˆë‹¤">
        <div class="badge c-blue">BL</div>
        <div class="label">Blue line</div>
      </a>
          <span></span><span></span><span></span>
        </div>
      </div>
      <div class="folder-label" id="sec-pc"><span class="emoji" aria-hidden="true">â¤ï¸</span><span>P&amp;C</span></div>
    </section>

    <!-- ğŸ‘ ì¬ê²½ -->
    <section aria-labelledby="sec-fin">
      <div class="folder" role="group" aria-labelledby="sec-fin">
        <div class="apps">
          <a class="app" href="http://gwa.compassion.or.kr/gw/userMain.do" target="_blank" rel="noopener noreferrer"><div class="badge c-green">GW</div><div class="label">ê·¸ë£¹ì›¨ì–´</div></a>
          <a class="app" href="#" target="_blank" rel="noopener noreferrer"><div class="badge c-orange">BIZ</div><div class="label">Bizplay</div></a>
          <a class="app" href="#" target="_blank" rel="noopener noreferrer"><div class="badge c-teal">CHAT</div><div class="label">Chat FIV</div></a>
          <span></span><span></span><span></span><span></span><span></span><span></span>
        </div>
      </div>
      <div class="folder-label" id="sec-fin"><span class="emoji" aria-hidden="true">ğŸ‘</span><span>ì¬ê²½</span></div>
    </section>

    <!-- ğŸ¬ ë¸Œëœë”© -->
    <section aria-labelledby="sec-brand">
      <div class="folder" role="group" aria-labelledby="sec-brand">
        <div class="apps">
          <a class="app" href="#" target="_blank" rel="noopener noreferrer"><div class="badge c-purple">BR</div><div class="label">ë¸Œëœë“œ í—ˆë¸Œ</div></a>
          <a class="app" href="#" target="_blank" rel="noopener noreferrer"><div class="badge c-red">YT</div><div class="label">ìœ íŠœë¸Œ</div></a>
          <a class="app" href="#" target="_blank" rel="noopener noreferrer"><div class="badge c-green">NP</div><div class="label">ë„¤ì´ë²„ í¬ìŠ¤íŠ¸</div></a>
          <a class="app" href="#" target="_blank" rel="noopener noreferrer"><div class="badge c-blue">ì‡¼ì¸ </div><div class="label">ìˆì¸ </div></a>
          <span></span><span></span><span></span><span></span><span></span>
        </div>
      </div>
      <div class="folder-label" id="sec-brand"><span class="emoji" aria-hidden="true">ğŸ¬</span><span>ë¸Œëœë”©</span></div>
    </section>

    <!-- ğŸ’œ Website -->
    <section aria-labelledby="sec-web">
      <div class="folder" role="group" aria-labelledby="sec-web">
        <div class="apps">
          <a class="app" href="#" target="_blank" rel="noopener noreferrer"><div class="badge c-teal">ONE</div><div class="label">ê¸€ë¡œë²Œ ONE</div></a>
          <a class="app" href="#" target="_blank" rel="noopener noreferrer"><div class="badge c-gray">CSF</div><div class="label">CSF</div></a>
          <a class="app" href="#" target="_blank" rel="noopener noreferrer"><div class="badge c-sky">WEB</div><div class="label">ì»´í¼ë‹ˆ í™ˆí˜ì´ì§€</div></a>
          <span></span><span></span><span></span><span></span><span></span><span></span>
        </div>
      </div>
      <div class="folder-label" id="sec-web"><span class="emoji" aria-hidden="true">ğŸ’œ</span><span>Website</span></div>
    </section>
  </div>

  <!-- ====================== ì „ì‚¬ì¼ì •&í–‰ì‚¬ ====================== -->
  <!-- (SP Modern Header / Toolbar ì¶”ê°€) -->
  <section class="sp-hero" aria-labelledby="ecal-title">
    <div class="sp-breadcrumb" aria-label="breadcrumb">
      <span>About Us</span> <span class="sep">/</span>
      <span>Enterprise Calendar</span>
    </div>
    <div class="sp-titlebar">
      <h2 id="ecal-title">Enterprise Calendar</h2>
      <div class="sp-actions" role="toolbar" aria-label="Calendar actions">
        <button type="button" class="btn ghost" id="btn-compact" aria-pressed="false" title="ë°€ì§‘ ë³´ê¸°">Compact</button>
        <button type="button" class="btn" id="btn-export" title="CSVë¡œ ë‚´ë³´ë‚´ê¸°">Export</button>
      <a href="event" class="btn primary">Add Event
</a>
      </div>
    </div>
    <p class="sp-sub">ì „ì‚¬ ì¼ì •ê³¼ ì£¼ìš” í–‰ì‚¬ ì¼ì •ì„ ì›” ë‹¨ìœ„ë¡œ í•œëˆˆì— í™•ì¸í•˜ì„¸ìš”.</p>
  </section>

  <!-- (A) ìŠ¤í¬ë¦°ìƒ· ì´ë¯¸ì§€ë„ ê°™ì´ í‘œì‹œí•˜ê³  í´ë¦­ ì‹œ í™•ëŒ€ -->
  <div class="card imgbox" aria-label="ì „ì‚¬ ì¼ì • ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°">
    <img id="calendar-thumb" src="enterprise-calendar.png" alt="Enterprise Calendar" loading="lazy" onclick="openImage()" onload="calendarImageReady()" onerror="calendarImageMissing()" />
  </div>

  <!-- (í•„í„°/ë³´ê¸° ì „í™˜) -->
  <div class="controls" aria-label="ë³´ê¸° ë° í•„í„°">
    <div class="seg" role="tablist" aria-label="ë³´ê¸° ì „í™˜">
      <button id="btn-view-cat" role="tab" aria-selected="true" aria-pressed="true">ì¹´í…Œê³ ë¦¬ë³„</button>
      <button id="btn-view-team" role="tab" aria-selected="false" aria-pressed="false">íŒ€ë³„</button>
    </div>
    <div id="filter-cat" class="scroll-x" aria-label="ì¹´í…Œê³ ë¦¬ ì„ íƒ">
      <!-- ì¹´í…Œê³ ë¦¬ í”¼illsê°€ ìƒì„±ë©ë‹ˆë‹¤ -->
    </div>
    <div id="filter-team" class="scroll-x" aria-label="íŒ€ ì„ íƒ" style="display:none">
      <!-- íŒ€ í”¼illsê°€ ìƒì„±ë©ë‹ˆë‹¤ -->
    </div>
  </div>

  <!-- (B) ì—°ê°„ ë§¤íŠ¸ë¦­ìŠ¤ í‘œ -->
  <div class="card year-grid" style="margin-top:8px" id="year-grid" aria-labelledby="year-title">
    <div id="year-title" class="visually-hidden" aria-hidden="true">ì—°ê°„ ì¼ì • ë§¤íŠ¸ë¦­ìŠ¤</div>
    <div class="header">
      <div style="border-right:1px solid var(--grid)"></div>
      <div>1ì›”</div><div>2ì›”</div><div>3ì›”</div><div>4ì›”</div><div>5ì›”</div><div>6ì›”</div>
      <div>7ì›”</div><div>8ì›”</div><div>9ì›”</div><div>10ì›”</div><div>11ì›”</div><div>12ì›”</div>
    </div>
    <div id="lane-rows"></div>
    <div class="grid-lines" aria-hidden="true">
      <div></div><div></div><div></div><div></div><div></div><div></div>
      <div></div><div></div><div></div><div></div><div></div><div></div>
    </div>
    <div class="today-line" id="today-line" aria-hidden="true"></div>
    <div class="bar-layer" id="bar-layer"></div>
  </div>
  <p class="hint">â€» ì•„ë˜ <code>events</code> ë°ì´í„°ëŠ” ë¡œì»¬ì— ì €ì¥ë©ë‹ˆë‹¤. ì¹´í…Œê³ ë¦¬/íŒ€ìœ¼ë¡œ í•„í„°í•´ì„œ ë³´ê±°ë‚˜, ì•„ë˜ í¼ì—ì„œ ìƒˆ ì¼ì •ì„ ì¶”ê°€í•˜ì„¸ìš”.</p>

  <!-- (C) ì¼ì • ì…ë ¥ í¼) -->
  <form id="event-form" class="card" style="margin-top:12px;padding:12px" aria-label="ì¼ì • ì…ë ¥">
    <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:10px;align-items:end">
      <label>ì œëª©<br><input required name="title" placeholder="ì˜ˆ: Leadership Day" style="width:100%;padding:8px;border:1px solid var(--grid);border-radius:8px"></label>
      <label>ì‹œì‘ì¼<br><input required type="date" name="start" style="width:100%;padding:8px;border:1px solid var(--grid);border-radius:8px"></label>
      <label>ì¢…ë£Œì¼<br><input required type="date" name="end" style="width:100%;padding:8px;border:1px solid var(--grid);border-radius:8px"></label>
      <label>ì¹´í…Œê³ ë¦¬<br>
        <select required name="category" style="width:100%;padding:8px;border:1px solid var(--grid);border-radius:8px">
          <option value="í–‰ì‚¬">í–‰ì‚¬</option>
          <option value="ì—…ë¬´">ì—…ë¬´</option>
          <option value="ì‹ ì²­">ì‹ ì²­</option>
        </select>
      </label>
      <label>íŒ€(ë ˆì¸)<br>
        <select required name="lane" style="width:100%;padding:8px;border:1px solid var(--grid);border-radius:8px" id="lane-select"></select>
      </label>
      <label style="grid-column:1/-1">ë©”ëª¨(ì„ íƒ)<br><input name="note" placeholder="ë¹„ê³ " style="width:100%;padding:8px;border:1px solid var(--grid);border-radius:8px"></label>
      <div style="display:flex;gap:8px">
        <button type="submit">ì¶”ê°€</button>
        <button type="button" id="btn-clear">ì´ˆê¸°í™”</button>
        <button type="button" id="btn-reset">ëª¨ë‘ ì‚­ì œ</button>
      </div>
    </div>
  </form>

  <!-- ê³µìš© ëª¨ë‹¬ -->
  <div id="modal" aria-hidden="true" role="dialog" aria-modal="true" aria-labelledby="m-title" aria-describedby="m-when m-dept m-note">
    <div class="box">
      <h3 id="m-title"></h3>
      <p id="m-when"></p>
      <p id="m-dept"></p>
      <p id="m-note"></p>
      <div class="modal-actions"><button class="close" id="closeBtn">ë‹«ê¸° (Esc)</button></div>
    </div>
  </div>
</div>

<script>
  // ---------- ìƒìˆ˜ ----------
  const CATEGORIES = ["í–‰ì‚¬","ì—…ë¬´","ì‹ ì²­"]; // ì¹´í…Œê³ ë¦¬ ì¶•
  const LANES = ["ì „ëµ","ì¬ê²½","ì¸ì‚¬","ì»´í”Œë¼ì´ì–¸ìŠ¤","IT","ìš´ì˜","ë§ˆì¼€íŒ…","ì˜ì—…","êµìœ¡","í–‰ì‚¬"]; // íŒ€/ë¶€ì„œ ì¶•
  const LS_KEY = 'gate:events:v1';

  // ---------- ìœ í‹¸ ----------
  const $ = (sel) => document.querySelector(sel);
  const $$ = (sel) => Array.from(document.querySelectorAll(sel));
  const KST = new Intl.DateTimeFormat('ko-KR', { timeZone:'Asia/Seoul', dateStyle:'medium' });
  const fmtRange = (s,e)=> `${KST.format(s)} ~ ${KST.format(e)}`;
  const parseDate = (s)=>{ const [y,m,d] = s.split('-').map(Number); return new Date(y, m-1, d); };

  // ---------- ì´ˆê¸° UI ë¹Œë“œ: ë ˆì¸ í–‰/ì…€ ----------
  const laneRows = $("#lane-rows");
  LANES.forEach((name)=>{
    const row = document.createElement("div");
    row.className="row"; row.setAttribute('role','row');
    row.innerHTML = `<div class="lane-name" role="rowheader">${name}</div>` + Array.from({length:12}).map(()=>`<div class="cell" role="gridcell"></div>`).join("");
    laneRows.appendChild(row);
  });

  // ë ˆì¸ ì„ íƒ ì˜µì…˜ ì±„ìš°ê¸°
  const laneSel = $("#lane-select");
  laneSel.innerHTML = LANES.map(l=>`<option value="${l}">${l}</option>`).join("");

  // ---------- í•„í„°/ë³´ê¸° ì»¨íŠ¸ë¡¤ ----------
  const catWrap = $("#filter-cat");
  const teamWrap = $("#filter-team");
  let viewMode = 'category'; // 'category' | 'team'
  let activeCategory = 'ì „ì²´';
  let activeTeam = 'ì „ì²´';

  function renderFilterPills(){
    // ì¹´í…Œê³ ë¦¬
    catWrap.innerHTML = '';
    ["ì „ì²´", ...CATEGORIES].forEach(cat=>{
      const b = document.createElement('button');
      b.className='pill'; b.type='button';
      b.textContent = cat; b.setAttribute('aria-pressed', String(activeCategory===cat));
      b.onclick = ()=>{ activeCategory = cat; refresh(); renderFilterPills(); };
      catWrap.appendChild(b);
    });
    // íŒ€
    teamWrap.innerHTML = '';
    ["ì „ì²´", ...LANES].forEach(team=>{
      const b = document.createElement('button');
      b.className='pill'; b.type='button';
      b.textContent = team; b.setAttribute('aria-pressed', String(activeTeam===team));
      b.onclick = ()=>{ activeTeam = team; refresh(); renderFilterPills(); };
      teamWrap.appendChild(b);
    });
  }

  // ë³´ê¸° ì „í™˜
  const btnViewCat = $("#btn-view-cat");
  const btnViewTeam = $("#btn-view-team");
  btnViewCat.onclick = ()=>{ viewMode='category'; btnViewCat.setAttribute('aria-pressed','true'); btnViewTeam.setAttribute('aria-pressed','false'); catWrap.style.display='flex'; teamWrap.style.display='none'; };
  btnViewTeam.onclick = ()=>{ viewMode='team'; btnViewCat.setAttribute('aria-pressed','false'); btnViewTeam.setAttribute('aria-pressed','true'); catWrap.style.display='none'; teamWrap.style.display='flex'; };

  // ---------- ë°ì´í„° ----------
  const DEFAULT_EVENTS = [
    { title:"Global Budget", start:"2025-02-10", end:"2025-03-20", lane:"ì „ëµ", category:"ì—…ë¬´", note:"PGS~PGS" },
    { title:"Global Connection", start:"2025-03-01", end:"2025-03-31", lane:"í–‰ì‚¬", category:"í–‰ì‚¬", note:"ì „ì‚¬ ì»¤ë®¤ë‹ˆì¼€ì´ì…˜" },
    { title:"Mission Update", start:"2025-05-01", end:"2025-05-31", lane:"í–‰ì‚¬", category:"í–‰ì‚¬", note:"ë¯¸ì…˜ ë¦¬í”„ë ˆì‹œ" },
    { title:"H1 Forecast ì •ë¦¬", start:"2025-04-01", end:"2025-04-30", lane:"ì¬ê²½", category:"ì—…ë¬´", note:"ìƒë°˜ê¸° FCST" },
    { title:"H2 Forecast ì¤€ë¹„", start:"2025-09-01", end:"2025-09-30", lane:"ì¬ê²½", category:"ì—…ë¬´", note:"í•˜ë°˜ê¸° FCST" },
    { title:"Performance Review(H1)", start:"2025-06-01", end:"2025-06-30", lane:"ì¸ì‚¬", category:"ì—…ë¬´", note:"í‰ê°€/ë³´ìƒ" },
    { title:"Leadership Day", start:"2025-10-01", end:"2025-10-07", lane:"ì¸ì‚¬", category:"í–‰ì‚¬", note:"ë¦¬ë”ì‹­ ì›Œí¬ìƒµ" },
    { title:"ë³´ì•ˆ/ì •ì±… ì ê²€", start:"2025-07-01", end:"2025-07-31", lane:"ì»´í”Œë¼ì´ì–¸ìŠ¤", category:"ì—…ë¬´", note:"ì •ê¸° ì ê²€" },
    { title:"ì‚¬ë‚´ êµìœ¡ ìœ„í¬", start:"2025-04-07", end:"2025-04-11", lane:"êµìœ¡", category:"ì‹ ì²­", note:"ì§ë¬´/ê¸°ìˆ  êµìœ¡ (ì‚¬ì „ ì‹ ì²­)" },
    { title:"ì‹ ì œí’ˆ ë¡ ì¹­ ìº í˜ì¸", start:"2025-06-01", end:"2025-07-15", lane:"ë§ˆì¼€íŒ…", category:"ì—…ë¬´", note:"ë©€í‹°ì±„ë„" },
    { title:"ê³ ê° ì»¨í¼ëŸ°ìŠ¤", start:"2025-11-10", end:"2025-11-12", lane:"ì˜ì—…", category:"í–‰ì‚¬", note:"ì£¼ìš” ê³ ê° ì´ˆì²­" }
  ];

  function loadEvents(){
    try{ const s = localStorage.getItem(LS_KEY); return s ? JSON.parse(s) : DEFAULT_EVENTS; }
    catch(e){ return DEFAULT_EVENTS; }
  }
  function saveEvents(list){ localStorage.setItem(LS_KEY, JSON.stringify(list)); }

  let events = loadEvents();

  // ---------- ë°” ë Œë” ----------
  const layer = document.getElementById("bar-layer");
  const yearGrid = document.getElementById("year-grid");
  const todayLine = document.getElementById("today-line");

  function monthIndex(d){ return d.getMonth(); } // 0..11
  function monthSpan(s,e){
    const months = (e.getFullYear()-s.getFullYear())*12 + (e.getMonth()-s.getMonth()) + 1;
    return Math.max(1, months);
  }
  function laneY(name){
    const idx = LANES.indexOf(name);
    const header = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--header-h'));
    const laneH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--lane-h'));
    const gap = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--lane-gap'));
    return header + idx * (laneH + gap);
  }
  function renderTodayLine(){
    const now = new Date();
    // ì›” + ì¼ ë¹„ìœ¨ ë°˜ì˜ (ë” ì •ë°€)
    const month = now.getMonth();
    const day = now.getDate();
    const daysInMonth = new Date(now.getFullYear(), month+1, 0).getDate();
    const monthFrac = month + (day-1)/daysInMonth; // 0~11.x
    const leftPct = (monthFrac/12)*100;
    todayLine.style.left = `calc(${leftPct}% + var(--left-col))`;
  }

  function filtered(list){
    return list.filter(ev => {
      const okCat = (activeCategory==='ì „ì²´') || (ev.category===activeCategory);
      const okTeam = (activeTeam==='ì „ì²´') || (ev.lane===activeTeam);
      return okCat && okTeam;
    });
  }

  function renderBars(){
    layer.innerHTML = '';
    const list = filtered(events);

    list.forEach((ev)=>{
      const s = parseDate(ev.start), e = parseDate(ev.end);
      const sIdx = monthIndex(s), span = monthSpan(s,e);
      const bar = document.createElement('div');
      bar.className = `event t-${ev.lane}`;
      bar.style.left = `calc(${(sIdx/12)*100}% + 6px)`;
      bar.style.top  = `${laneY(ev.lane) + 18}px`;
      bar.style.width= `calc(${(span/12)*100}% - 12px)`;
      bar.tabIndex = 0; bar.setAttribute('role','button');
      bar.setAttribute('aria-label', `${ev.lane} Â· ${ev.title} Â· ${ev.start} ~ ${ev.end} Â· ${ev.category}`);
      bar.textContent = ev.title;
      bar.addEventListener('click', ()=>openModal(ev));
      bar.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' ') { e.preventDefault(); openModal(ev); } });
      layer.appendChild(bar);
    });

    renderTodayLine();
  }

  // ---------- ëª¨ë‹¬ ----------
  function openModal(ev){
    document.getElementById("m-title").textContent = ev.title;
    const s = parseDate(ev.start), e = parseDate(ev.end);
    document.getElementById("m-when").textContent = `ì¼ì •: ${fmtRange(s,e)}`;
    document.getElementById("m-dept").textContent = `íŒ€: ${ev.lane} Â· ì¹´í…Œê³ ë¦¬: ${ev.category}`;
    document.getElementById("m-note").textContent = ev.note ? `ë©”ëª¨: ${ev.note}` : '';
    const modal = document.getElementById("modal");
    modal.setAttribute('aria-hidden','false');
    document.body.style.overflow='hidden';
    document.getElementById("closeBtn").focus();
  }
  function closeModal(){
    const modal = document.getElementById("modal");
    modal.setAttribute('aria-hidden','true');
    document.body.style.overflow='';
  }
  window.closeModal = closeModal;
  document.getElementById("modal").addEventListener('click', (e)=>{ if(e.target.id==='modal') closeModal(); });
  document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });
  document.getElementById("closeBtn").addEventListener('click', closeModal);

  // ---------- í¼ ----------
  const form = document.getElementById('event-form');
  const btnClear = document.getElementById('btn-clear');
  const btnReset = document.getElementById('btn-reset');

  form.addEventListener('submit', (e)=>{
    e.preventDefault();
    const fd = new FormData(form);
    const title = fd.get('title').toString().trim();
    const start = fd.get('start').toString();
    const end = fd.get('end').toString();
    const category = fd.get('category').toString();
    const lane = fd.get('lane').toString();
    const note = (fd.get('note')||'').toString().trim();

    if(!title || !start || !end) return;
    if(end < start){ alert('ì¢…ë£Œì¼ì´ ì‹œì‘ì¼ë³´ë‹¤ ë¹ ë¥¼ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.'); return; }

    const ev = { title, start, end, category, lane, note };
    events.push(ev);
    saveEvents(events);
    form.reset();
    refresh();
  });
  btnClear.addEventListener('click', ()=> form.reset());
  btnReset.addEventListener('click', ()=>{
    if(confirm('ëª¨ë“  ì¼ì •ì„ ì‚­ì œí•˜ê³  ê¸°ë³¸ ì˜ˆì‹œë¡œ ì´ˆê¸°í™”í• ê¹Œìš”?')){
      events = DEFAULT_EVENTS.slice();
      saveEvents(events);
      refresh();
    }
  });

  // ---------- ì´ˆê¸° ë Œë” ----------
  function refresh(){ renderBars(); }
  renderFilterPills();
  refresh();

  // ---------- ì´ë¯¸ì§€ í™•ëŒ€ & ì´ë¯¸ì§€ ì¡´ì¬ ì—¬ë¶€ ì²˜ë¦¬ ----------
  let imageAvailable = false;
  function calendarImageReady(){ imageAvailable = true; }
  function calendarImageMissing(){
    imageAvailable = false;
    const box = document.querySelector('.imgbox');
    if (box) box.remove(); // ì¸ë„¤ì¼ ì¹´ë“œ ìì²´ ì œê±° â†’ ê¹¨ì§„ ì•„ì´ì½˜/ëŒ€ì²´í…ìŠ¤íŠ¸ ë…¸ì¶œ ë°©ì§€
  }
  function openImage(){
    if(!imageAvailable){
      return;
    }
    document.getElementById("m-title").textContent = 'ì „ì‚¬ì¼ì •&í–‰ì‚¬ (ì´ë¯¸ì§€ ë³´ê¸°)';
    document.getElementById("m-when").innerHTML = '<img src="enterprise-calendar.png" style="width:100%;border:1px solid #e5e7eb;border-radius:8px" alt="calendar" />';
    document.getElementById("m-dept").textContent = '';
    document.getElementById("m-note").textContent = '';
    document.getElementById("modal").setAttribute('aria-hidden','false');
    document.body.style.overflow='hidden';
    document.getElementById("closeBtn").focus();
  }
  window.openImage = openImage;

  // ---------- SP Toolbar actions (ì¶”ê°€) ----------
  // Compact density toggle
  const btnCompact = document.getElementById('btn-compact');
  btnCompact?.addEventListener('click', ()=>{
    const on = document.body.classList.toggle('compact');
    btnCompact.setAttribute('aria-pressed', String(on));
    refresh();
  });

  // Export CSV
  const btnExport = document.getElementById('btn-export');
  btnExport?.addEventListener('click', ()=>{
   
  });

  // Add Event â†’ í¼ìœ¼ë¡œ ìŠ¤í¬ë¡¤
  const btnAdd = document.getElementById('btn-add');
  btnAdd?.addEventListener('click', ()=>{
    document.getElementById('event-form')?.scrollIntoView({behavior:'smooth', block:'start'});
    const first = document.querySelector('#event-form input[name="title"]');
    if(first) first.focus();
  });

  // ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ìœ„ì¹˜ ì¬ê³„ì‚°
  window.addEventListener('resize', refresh);
// ===== Tooltip (data-tooltip ë³´ìœ  ìš”ì†Œìš©) =====
(function setupTooltip(){
  // íˆ´íŒ ì—˜ë¦¬ë¨¼íŠ¸ 1ê°œë§Œ ë™ì  ìƒì„±
  const tip = document.createElement('div');
  tip.className = 'tooltip';
  tip.setAttribute('role', 'tooltip');
  tip.setAttribute('aria-hidden', 'true');
  document.body.appendChild(tip);

  let activeEl = null;

  // ë§í’ì„  ìœ„ì¹˜ ê³„ì‚° (ë·°í¬íŠ¸ ë°–ìœ¼ë¡œ ë‚˜ê°€ì§€ ì•Šë„ë¡ ë³´ì •)
  function positionTip(x, y){
    const margin = 10;     // ê°€ì¥ìë¦¬ ì—¬ìœ 
    const offsetY = 18;    // ë§ˆìš°ìŠ¤ ìœ„ë¡œ ë„ìš°ê¸°
    const vw = window.innerWidth;
    const vh = window.innerHeight;

    // ë¨¼ì € ì¤‘ì•™ ê¸°ì¤€ ì¢Œí‘œ ë°°ì¹˜
    let left = x;
    let top  = y - offsetY;

    // ì¼ë‹¨ í‘œì‹œí•´ ë³´ê³  í¬ê¸° ì¸¡ì •
    tip.style.left = `${left}px`;
    tip.style.top  = `${top}px`;
    const rect = tip.getBoundingClientRect();

    // ì¢Œìš°/ìƒí•˜ ë²”ìœ„ ë³´ì •
    if (rect.left < margin)       left += (margin - rect.left);
    if (rect.right > vw - margin) left -= (rect.right - (vw - margin));
    if (rect.top < margin)        top  = y + offsetY; // ìœ„ê°€ ë¶€ì¡±í•˜ë©´ ì•„ë˜ë¡œ
    if (rect.bottom > vh - margin) top = vh - margin - rect.height;

    tip.style.left = `${left}px`;
    tip.style.top  = `${top}px`;
  }

  function showTip(el, clientX, clientY){
    const text = el.getAttribute('data-tooltip');
    if (!text) return;
    activeEl = el;
    tip.textContent = text;
    tip.dataset.show = 'true';
    tip.setAttribute('aria-hidden', 'false');
    positionTip(clientX ?? (el.getBoundingClientRect().left + el.offsetWidth/2),
                clientY ?? (el.getBoundingClientRect().top));
  }

  function hideTip(){
    activeEl = null;
    tip.dataset.show = 'false';
    tip.setAttribute('aria-hidden', 'true');
  }

  // ë§ˆìš°ìŠ¤ ì´ë²¤íŠ¸: data-tooltip ê°€ì§„ ìš”ì†Œì—ë§Œ ì ìš© (ì´ë²¤íŠ¸ ìœ„ì„)
  document.addEventListener('mouseover', (e)=>{
    const el = e.target.closest('[data-tooltip]');
    if (!el) return;
    showTip(el, e.clientX, e.clientY);
  });
  document.addEventListener('mousemove', (e)=>{
    if (!activeEl) return;
    positionTip(e.clientX, e.clientY);
  });
  document.addEventListener('mouseout', (e)=>{
    // í™œì„± ìš”ì†Œë¥¼ ë²—ì–´ë‚¬ì„ ë•Œë§Œ ë‹«ê¸°
    if (activeEl && !e.relatedTarget?.closest('[data-tooltip]')) hideTip();
  });

  // í‚¤ë³´ë“œ ì ‘ê·¼ì„±: í¬ì»¤ìŠ¤ ë“¤ì–´ì˜¤ë©´ í‘œì‹œ, ë¹ ì§€ë©´ ìˆ¨ê¹€
  document.addEventListener('focusin', (e)=>{
    const el = e.target.closest('[data-tooltip]');
    if (!el) return;
    // í¬ì»¤ìŠ¤ ì‹œì—” ìš”ì†Œ ì¤‘ì‹¬ ê¸°ì¤€ ìœ„ì¹˜
    const r = el.getBoundingClientRect();
    showTip(el, r.left + r.width/2, r.top);
  });
  document.addEventListener('focusout', (e)=>{
    if (e.target.closest('[data-tooltip]')) hideTip();
  });

  // ìŠ¤í¬ë¡¤/ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ìœ„ì¹˜ ì—…ë°ì´íŠ¸
  window.addEventListener('scroll', ()=>{
    if (!activeEl || tip.getAttribute('aria-hidden')==='true') return;
    const r = activeEl.getBoundingClientRect();
    positionTip(r.left + r.width/2, r.top);
  }, { passive: true });
  window.addEventListener('resize', ()=>{
    if (!activeEl || tip.getAttribute('aria-hidden')==='true') return;
    const r = activeEl.getBoundingClientRect();
    positionTip(r.left + r.width/2, r.top);
  });
})();

</script>
</body>
</html>





